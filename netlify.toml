[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "18"

[dev]
  command = "npm run dev"
  port = 8888
  targetPort = 5173
  autoLaunch = false

[functions]
  directory = "netlify/functions"
  external_node_modules = ["sharp", "node-fetch", "@supabase/supabase-js"]

[[headers]]
  for = "/*.js"
  [headers.values]
    Content-Type = "application/javascript"

[[headers]]
  for = "/*.mjs"
  [headers.values]
    Content-Type = "application/javascript"

# API redirects for production
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# PostHog reverse proxy
[[edge_functions]]
  function = "posthog-proxy"
  path = "/a/*"
